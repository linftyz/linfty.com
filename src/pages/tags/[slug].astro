---
import PostPreview from "@/components/blocks/PostPreview.astro";
import Layout from "../../layouts/Layout.astro";
import { getCollection } from "astro:content";
import { getPosts } from "@/utils/post";
import { Icon } from "astro-icon/components";

export async function getStaticPaths() {
  const allTags = await getCollection("tags");
  const allPosts = await getPosts();

  return allTags.map((tag) => {
    const filteredPosts = allPosts.filter((post) =>
      post.data.tags.some((value) => {
        return value.id === tag.id;
      }),
    );
    return {
      params: { slug: tag.data.slug },
      props: { tag: tag, posts: filteredPosts },
    };
  });
}

const { tag, posts } = Astro.props;
---

<Layout
  title={`标签: ${tag.data.name}`}
  description={`关于 ${tag.data.name} 的内容`}
>
  <div class="mx-auto max-w-2xl p-8 md:p-16">
    <header class="mb-16">
      <a
        href="/categories"
        class="mb-6 flex items-center gap-1 text-[10px] font-bold tracking-widest text-muted-foreground/60 uppercase transition-colors hover:text-primary"
      >
        <Icon name="mdi:arrow-left" size={14} /> 返回标签列表
      </a>
      <h2 class="mb-4 text-3xl font-bold tracking-tight">
        标签：<span class="text-primary">{tag.data.name}</span>
      </h2>
      <p
        class="border-l-2 border-primary/20 py-1 pl-4 text-sm font-light text-muted-foreground italic"
      >
        {tag.data.description}
      </p>
    </header>

    <div class="space-y-1">
      {posts.map((post) => <PostPreview post={post} />)}
    </div>
  </div>
</Layout>
