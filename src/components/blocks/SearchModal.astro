---

---

<div
  id="search-modal"
  class="group pointer-events-none fixed inset-0 z-100 flex items-start justify-center px-4 pt-[12vh]"
>
  <div
    id="modal-overlay"
    class="backdrop-blur-1 absolute inset-0 bg-background/0 transition-all duration-500 ease-out group-[.is-active]:pointer-events-auto group-[.is-active]:bg-background/60 group-[.is-active]:backdrop-blur-lg"
  >
  </div>
  <div
    id="modal-content"
    class="relative w-full max-w-xl translate-y-8 scale-95 overflow-hidden rounded-2xl border border-border bg-card opacity-0 shadow-main transition-all duration-500 ease-out group-[.is-active]:pointer-events-auto group-[.is-active]:translate-y-0 group-[.is-active]:scale-100 group-[.is-active]:opacity-100"
  >
    <div id="pagefind-search-ui" class="p-6"></div>

    <div class="border-t border-border/40 px-8 pt-6 pb-8">
      <p
        class="mb-4 text-[10px] font-bold tracking-[0.3em] text-muted-foreground uppercase opacity-60"
      >
        快速跳转 / Navigate
      </p>
      <div class="flex flex-wrap gap-2">
        {
          ["categories", "tags", "tools"].map((item) => (
            <a
              href={`/${item}`}
              class="rounded-xl border border-border bg-muted/30 px-3 py-1.5 text-xs text-muted-foreground capitalize transition-all hover:text-primary"
            >
              {item}
            </a>
          ))
        }
      </div>
    </div>
  </div>
</div>

<script>
  function setupSearch() {
    const trigger = document.getElementById("search-trigger");
    const modal = document.getElementById("search-modal");
    const overlay = document.getElementById("modal-overlay");

    if (
      // @ts-ignore
      typeof PagefindUI !== "undefined" &&
      !document.querySelector(".pagefind-ui")
    ) {
      // @ts-ignore
      new PagefindUI({
        element: "#pagefind-search-ui",
        showSubResults: true,
        resetStyles: false,
        translations: { placeholder: "搜索文章、标签或命令..." },
      });
    }

    const toggle = (show: boolean) => {
      if (show) {
        modal?.classList.add("is-active");
        setTimeout(() => modal?.querySelector("input")?.focus(), 100);
      } else {
        modal?.classList.remove("is-active");
      }
    };

    trigger?.addEventListener("click", (e) => {
      e.preventDefault();
      toggle(true);
    });
    overlay?.addEventListener("click", () => toggle(false));

    const onKeyDown = (e: KeyboardEvent) => {
      if ((e.metaKey || e.ctrlKey) && e.key === "k") {
        e.preventDefault();
        toggle(true);
      }
      if (e.key === "Escape") toggle(false);
    };
    window.addEventListener("keydown", onKeyDown);
  }

  document.addEventListener("astro:page-load", setupSearch);
</script>

<style is:global>
  :root {
    --pagefind-ui-primary: var(--primary);
    --pagefind-ui-text: var(--foreground);
    --pagefind-ui-font: inherit;
    --pagefind-ui-background: var(--background);
    --pagefind-ui-border: var(--primary) / 10;
  }

  .pagefind-ui__drawer {
    margin-top: 0 !important;
    padding-top: 0 !important;
    max-height: 500px !important;
    overflow-y: auto !important;
  }

  .pagefind-ui__message {
    padding: 0 0.5rem 1rem 0.5rem !important;
    margin: 0 !important;
    font-size: 0.75rem !important;
    font-weight: 600 !important;
    color: var(--muted-foreground) !important;
    opacity: 0.6 !important;
  }

  .pagefind-ui__result {
    display: flex !important;
    flex-direction: column !important;
    padding: 1.25rem 0.5rem !important; /* 压缩单项间距 */
    border-bottom: 1px solid oklch(from var(--border) l c h / 0.4) !important;
    margin: 0 !important;
  }

  .pagefind-ui__result-thumb {
    display: none !important;
  }

  .pagefind-ui__result-inner {
    flex: 1 !important;
    display: flex !important;
    flex-direction: column !important;
    align-items: flex-start !important;
    margin: 0 !important; /* 移除缩略图留下的左边距 */
  }

  .pagefind-ui__result-link {
    font-size: 1.1rem !important;
    font-weight: 800 !important;
    color: var(--foreground) !important;
    text-decoration: none !important;
    margin-bottom: 0.25rem !important;
  }

  .pagefind-ui__result-title {
    font-size: 1rem !important;
    font-weight: 700 !important;
    color: var(--foreground) !important;
  }

  .pagefind-ui__result-excerpt {
    font-size: 0.8rem !important;
    color: oklch(from var(--muted-foreground) 0.6 c h) !important;
    line-height: 1.8 !important;
    font-weight: normal !important;
    margin-top: 0.4rem !important;
  }

  .pagefind-ui__result-nested .pagefind-ui__result-link {
    display: flex !important;
    flex-direction: column !important;
    position: relative !important;
    padding-left: 1.5rem !important;
    margin-top: 0.75rem !important;
    font-weight: normal !important;
    font-size: 1rem !important;
  }

  .pagefind-ui__result-nested .pagefind-ui__result-link::before {
    content: "## " !important;
    position: absolute !important;
    margin-right: 10px;
    left: 0 !important;
    color: var(--primary) !important;
    font-weight: bold !important;
    font-size: 1.1rem !important;
    line-height: 24px;
  }

  mark {
    background-color: oklch(from var(--primary) l c h / 0.15) !important;
    color: var(--primary) !important;
    font-weight: 600 !important;
    border-bottom: 1.5px solid oklch(from var(--primary) l c h / 0.4) !important;
    padding: 0 2px !important;
    border-radius: 2px !important;
  }

  .pagefind-ui__search-input:focus {
    outline: none !important;
    border-color: var(--primary) !important;
    box-shadow: 0 0 0 4px oklch(from var(--primary) l c h / 0.1) !important;
  }
</style>
